// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © henry_oliver

//@version=6
indicator(title = "NASDAQ 100 Advance-Decline Issues Delta", shorttitle = "NDX A/D Δ", overlay = false)

// === CONSTANTS ===
// Nord Theme Color
const color NORD1  = #3B4252
const color NORD8  = #88C0D0
const color NORD9  = #81A1C1

// === INPUTS ===
// Candle Styling
bool showBody = input.bool(defval = true, title = "Show Candle Body", group = "Candle Styling", tooltip = "Toggle visibility of the candle body")
bool showWick = input.bool(defval = true, title = "Show Candle Wick", group = "Candle Styling", tooltip = "Toggle visibility of the candle wicks")
bool showBorder = input.bool(defval = true, title = "Show Candle Border", group = "Candle Styling", tooltip = "Toggle visibility of the candle border")

// === DATA FETCHING ===
// Fetch NASDAQ 100 advancing issues OHLC
[advOpen, advHigh, advLow, advClose] = request.security(symbol = "USI:ADVN.NQ", timeframe = timeframe.period, expression = [open, high, low, close], lookahead = barmerge.lookahead_off)

// Fetch NASDAQ 100 declining issues OHLC
[declOpen, declHigh, declLow, declClose] = request.security(symbol = "USI:DECL.NQ", timeframe = timeframe.period, expression = [open, high, low, close], lookahead = barmerge.lookahead_off)

// Calculate advance-decline delta for each OHLC component
float deltaOpen = advOpen - declOpen
float deltaHigh = advHigh - declHigh
float deltaLow = advLow - declLow
float deltaClose = advClose - declClose

// === VISUALIZATION ===
// Determine candle color based on open vs close
color candleColor = deltaClose >= deltaOpen ? NORD8 : NORD9

// Apply visibility toggles
color bodyColor = showBody ? candleColor : na
color wickColor = showWick ? candleColor : na
color borderColor = showBorder ? candleColor : na

// Plot advance-decline delta as candlesticks
plotcandle(open = deltaOpen, high = deltaHigh, low = deltaLow, close = deltaClose, title = "Advance-Decline Delta", color = bodyColor, wickcolor = wickColor, bordercolor = borderColor, editable = true)

// Plot zero line
hline(price = 0, title = "Zero Line", color = NORD1, linestyle = hline.style_solid, linewidth = 3, editable = true)
